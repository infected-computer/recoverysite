var e=Object.defineProperty;import{r as t,j as s}from"./react-vendor-mWrko00G.js";import{H as a}from"../index-DcaeLAZ_.js";import{H as r,F as o}from"./Footer-By0mtB6L.js";import{o as n,s as i,e as c,n as m,l}from"./form-vendor-C3kxPxaD.js";import"./ui-vendor-C8vMcHtE.js";import"./utils-vendor-CtF19A-_.js";import"./icons-vendor-Dht0aATl.js";import"./query-vendor-CEtOlt5U.js";import"./react-router-D2ATJgFQ.js";var u=(e=>(e.PAYMENT_DECLINED="PAYMENT_DECLINED",e.INVALID_AMOUNT="INVALID_AMOUNT",e.NETWORK_ERROR="NETWORK_ERROR",e.API_ERROR="API_ERROR",e.USER_CANCELLED="USER_CANCELLED",e))(u||{});const d={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_LEMON_SQUEEZY_ENVIRONMENT:"sandbox"},E={LEMON_SQUEEZY:{API_BASE_URL:"https://api.lemonsqueezy.com/v1",API_KEY:"",STORE_ID:"",ENVIRONMENT:"sandbox",WEBHOOK_SECRET:""},HIDDEN_PAGE:{ACCESS_TOKEN:"default-token",PATH:"/secure-payment"},VALIDATION:{MIN_AMOUNT:1,MAX_AMOUNT:1e4,SUPPORTED_CURRENCIES:["ILS"],AMOUNT_DECIMAL_PLACES:2},SECURITY:{RATE_LIMIT_ATTEMPTS:5,RATE_LIMIT_WINDOW:9e5,SESSION_TIMEOUT:18e5},UI:{LOADING_TIMEOUT:3e4,RETRY_ATTEMPTS:3,RETRY_DELAY:2e3},BUSINESS:{NAME:"דוקטור פיקס - שירותי שחזור קבצים",ADDRESS:"ישראל",TAX_ID:"ח.פ. ישראלי",EMAIL:"doctorfix79@gmail.com"}},p=()=>{if(["VITE_LEMON_SQUEEZY_API_KEY","VITE_LEMON_SQUEEZY_STORE_ID"].filter(e=>!d[e]).length>0)throw new Error("Payment system configuration is incomplete");return E};E.REDIRECT_URLS={SUCCESS:"https://recoverysite.netlify.app/payment-success",ERROR:"https://recoverysite.netlify.app/payment-error",CANCEL:"https://recoverysite.netlify.app/payment-cancel"},n({amount:m().min(E.VALIDATION.MIN_AMOUNT,`הסכום חייב להיות לפחות ₪${E.VALIDATION.MIN_AMOUNT}`).max(E.VALIDATION.MAX_AMOUNT,`הסכום לא יכול לעלות על ₪${E.VALIDATION.MAX_AMOUNT}`).refine(e=>Number.isFinite(e)&&e>0,"הסכום חייב להיות מספר חיובי תקין").refine(e=>(e.toString().split(".")[1]||"").length<=E.VALIDATION.AMOUNT_DECIMAL_PLACES,`הסכום יכול להכיל לכל היותר ${E.VALIDATION.AMOUNT_DECIMAL_PLACES} ספרות אחרי הנקודה`),currency:c(E.VALIDATION.SUPPORTED_CURRENCIES,{errorMap:()=>({message:"מטבע חייב להיות שקלים"})}),customerEmail:i().email("אנא הזן כתובת אימייל תקינה").optional().or(l("")),customerName:i().min(2,"השם חייב להכיל לפחות 2 תווים").max(100,"השם לא יכול להכיל יותר מ-100 תווים").optional().or(l(""))});const h=new class{constructor(){var t,s;((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(this,"symbol"!=typeof(t="config")?t+"":t,s);const a=p();this.config=a.LEMON_SQUEEZY}async createCheckout(e){try{const s={data:{type:"checkouts",attributes:{checkout_data:{custom:{amount:(t=e.amount,Math.round(100*t)),currency:e.currency}},product_options:{name:"Custom Payment",description:`Payment of ${e.amount} ${e.currency}`,redirect_url:p().REDIRECT_URLS.SUCCESS},checkout_options:{embed:!1,media:!1,logo:!1}},relationships:{store:{data:{type:"stores",id:this.config.STORE_ID}}}}};(e.customerEmail||e.customerName)&&(s.data.attributes.checkout_data.custom={...s.data.attributes.checkout_data.custom,customer_email:e.customerEmail||"",customer_name:e.customerName||""});const a=await fetch(`${this.config.API_BASE_URL}/checkouts`,{method:"POST",headers:{Authorization:`Bearer ${this.config.API_KEY}`,"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"},body:JSON.stringify(s)});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.errors?.[0]?.detail||`HTTP ${a.status}: ${a.statusText}`)}const r=await a.json();if(!r.data?.attributes?.url)throw new Error("Invalid response from Lemon Squeezy - missing checkout URL");return r.data.attributes.url}catch(s){throw this.handleError(s)}var t}async processPayment(e){try{if(!this.validatePaymentData(e))throw new Error("Invalid payment data");const t=await this.createCheckout(e);return window.location.href=t,{success:!0,transactionId:`pending-${Date.now()}`}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Payment processing failed"}}}validatePaymentData(e){return!(!e.amount||e.amount<=0||!e.currency||"ILS"!==e.currency||e.customerEmail&&!this.isValidEmail(e.customerEmail))}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}handleError(e){return e instanceof Error?e.message.includes("fetch")?{type:u.NETWORK_ERROR,message:"Network connection failed. Please check your internet connection.",details:e.message}:e.message.includes("HTTP")?{type:u.API_ERROR,message:"Payment service is temporarily unavailable. Please try again later.",details:e.message}:e.message.toLowerCase().includes("amount")?{type:u.INVALID_AMOUNT,message:"Invalid payment amount. Please check the amount and try again.",details:e.message}:{type:u.API_ERROR,message:e.message,details:e}:{type:u.API_ERROR,message:"An unexpected error occurred. Please try again.",details:e}}async getCheckoutStatus(e){try{const t=await fetch(`${this.config.API_BASE_URL}/checkouts/${e}`,{headers:{Authorization:`Bearer ${this.config.API_KEY}`,Accept:"application/vnd.api+json"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}catch(t){throw t}}verifyWebhookSignature(e,t){return t===this.config.WEBHOOK_SECRET}},x=()=>{const[e,a]=t.useState({amount:0,customerEmail:"",customerName:""}),[r,o]=t.useState(!1),[n,i]=t.useState(null),c=(e,t)=>{if("amount"===e&&"string"==typeof t){const e=parseFloat(t);t=isNaN(e)?0:e}a(s=>({...s,[e]:t})),i(null)},m=e=>new Intl.NumberFormat("he-IL",{style:"currency",currency:"ILS"}).format(e);return s.jsx("div",{className:"payment-form",children:s.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),e.amount<=0)i("אנא הזן סכום תקין");else if(e.amount<10)i("סכום מינימלי לתשלום: 10 ₪");else if(e.amount>1e4)i("סכום מקסימלי לתשלום: 10,000 ₪");else{o(!0),i(null);try{const t={amount:e.amount,currency:"ILS",customerEmail:e.customerEmail||void 0,customerName:e.customerName||void 0},s=await h.processPayment(t);if(!s.success)throw new Error(s.error||"התשלום נכשל. אנא נסה שוב.")}catch(s){i(s instanceof Error?s.message:"שגיאה בעיבוד התשלום")}finally{o(!1)}}},className:"space-y-6",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-2",children:"סכום לתשלום (בשקלים) *"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("span",{className:"text-gray-500 sm:text-sm",children:"₪"})}),s.jsx("input",{type:"number",id:"amount",name:"amount",min:"10",max:"10000",step:"1",value:e.amount||"",onChange:e=>c("amount",e.target.value),className:"block w-full pl-7 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"הזן סכום בשקלים",disabled:r,required:!0})]}),e.amount>0&&s.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:['סה"כ: ',m(e.amount)]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"customerEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"כתובת אימייל (אופציונלי)"}),s.jsx("input",{type:"email",id:"customerEmail",name:"customerEmail",value:e.customerEmail,onChange:e=>c("customerEmail",e.target.value),className:"block w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"your@email.com",disabled:r})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"customerName",className:"block text-sm font-medium text-gray-700 mb-2",children:"שם מלא (אופציונלי)"}),s.jsx("input",{type:"text",id:"customerName",name:"customerName",value:e.customerName,onChange:e=>c("customerName",e.target.value),className:"block w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"השם המלא שלך",disabled:r})]}),n&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsx("p",{className:"text-sm text-red-600",children:n})}),s.jsx("div",{className:"form-group",children:s.jsx("button",{type:"submit",disabled:e.amount<=0||r,className:"w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 "+(e.amount<=0||r?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:r?s.jsx("span",{children:"מעבד תשלום..."}):s.jsxs(s.Fragment,{children:["המשך לתשלום",e.amount>0&&s.jsxs("span",{className:"mr-2",children:["(",m(e.amount),")"]})]})})}),s.jsx("div",{className:"text-center text-sm text-gray-500",children:s.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),s.jsx("span",{children:"תשלום מאובטח באמצעות Lemon Squeezy"})]})})]})})},N=()=>s.jsxs("div",{className:"flex flex-col min-h-screen",children:[s.jsxs(a,{children:[s.jsx("title",{children:"תשלום מאובטח - דוקטור פיקס שחזור קבצים"}),s.jsx("meta",{name:"description",content:"דף תשלום מאובטח עבור שירותי שחזור קבצים ונתונים"}),s.jsx("meta",{name:"robots",content:"noindex, nofollow"}),s.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),s.jsx("meta",{httpEquiv:"X-Content-Type-Options",content:"nosniff"}),s.jsx("meta",{httpEquiv:"X-XSS-Protection",content:"1; mode=block"}),s.jsx("meta",{httpEquiv:"Referrer-Policy",content:"strict-origin-when-cross-origin"}),s.jsx("link",{rel:"preconnect",href:"https://api.lemonsqueezy.com"}),s.jsx("link",{rel:"preconnect",href:"https://lemonsqueezy.com"}),s.jsx("meta",{httpEquiv:"Cache-Control",content:"no-cache, no-store, must-revalidate"}),s.jsx("meta",{httpEquiv:"Pragma",content:"no-cache"}),s.jsx("meta",{httpEquiv:"Expires",content:"0"})]}),s.jsx(r,{}),s.jsx("main",{className:"flex-grow bg-gray-50",children:s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"max-w-2xl mx-auto",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"תשלום מאובטח לשחזור קבצים"}),s.jsx("p",{className:"text-lg text-gray-600",children:"בצעו תשלום מאובטח עבור שירותי שחזור הקבצים שלנו"})]}),s.jsx(x,{})]})})})}),s.jsx(o,{})]});export{N as default};
