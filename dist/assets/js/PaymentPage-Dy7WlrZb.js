var e=Object.defineProperty,t=(t,r,s)=>((t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s)(t,"symbol"!=typeof r?r+"":r,s);import{r,j as s}from"./react-vendor-DkQB-SO9.js";import{H as a}from"../index-B41dCRTv.js";import{H as n,F as i}from"./Footer-8hu5GFtI.js";import{o,n as c,e as l,s as u,l as m,Z as d}from"./form-vendor-CHavBUhQ.js";import"./ui-vendor-Cc-iGM94.js";import"./utils-vendor-CAu7q4fp.js";import"./icons-vendor-BmQx_dGP.js";import"./query-vendor-BrnmHwSl.js";import"./react-router-HuN145YQ.js";import"./animation-vendor-CpdAK6Wc.js";const h={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_LEMON_SQUEEZY_ENVIRONMENT:"sandbox"},p={LEMON_SQUEEZY:{API_BASE_URL:"https://api.lemonsqueezy.com/v1",API_KEY:"",STORE_ID:"",ENVIRONMENT:"sandbox",WEBHOOK_SECRET:""},HIDDEN_PAGE:{ACCESS_TOKEN:"default-token",PATH:"/secure-payment"},VALIDATION:{MIN_AMOUNT:1,MAX_AMOUNT:1e4,SUPPORTED_CURRENCIES:["ILS"],AMOUNT_DECIMAL_PLACES:2},SECURITY:{RATE_LIMIT_ATTEMPTS:5,RATE_LIMIT_WINDOW:9e5,SESSION_TIMEOUT:18e5},UI:{LOADING_TIMEOUT:3e4,RETRY_ATTEMPTS:3,RETRY_DELAY:2e3},BUSINESS:{NAME:"דוקטור פיקס - שירותי שחזור קבצים",ADDRESS:"ישראל",TAX_ID:"ח.פ. ישראלי",EMAIL:"doctorfix79@gmail.com"}},g=()=>{if(["VITE_LEMON_SQUEEZY_API_KEY","VITE_LEMON_SQUEEZY_STORE_ID"].filter(e=>!h[e]).length>0)throw new Error("Payment system configuration is incomplete");return p};p.REDIRECT_URLS={SUCCESS:"https://recoverysite.netlify.app/payment-success",ERROR:"https://recoverysite.netlify.app/payment-error",CANCEL:"https://recoverysite.netlify.app/payment-cancel"};const y=o({amount:c().min(p.VALIDATION.MIN_AMOUNT,`הסכום חייב להיות לפחות ₪${p.VALIDATION.MIN_AMOUNT}`).max(p.VALIDATION.MAX_AMOUNT,`הסכום לא יכול לעלות על ₪${p.VALIDATION.MAX_AMOUNT}`).refine(e=>Number.isFinite(e)&&e>0,"הסכום חייב להיות מספר חיובי תקין").refine(e=>(e.toString().split(".")[1]||"").length<=p.VALIDATION.AMOUNT_DECIMAL_PLACES,`הסכום יכול להכיל לכל היותר ${p.VALIDATION.AMOUNT_DECIMAL_PLACES} ספרות אחרי הנקודה`),currency:l(p.VALIDATION.SUPPORTED_CURRENCIES,{errorMap:()=>({message:"מטבע חייב להיות שקלים"})}),customerEmail:u().email("אנא הזן כתובת אימייל תקינה").optional().or(m("")),customerName:u().min(2,"השם חייב להכיל לפחות 2 תווים").max(100,"השם לא יכול להכיל יותר מ-100 תווים").optional().or(m(""))}),f=(e,t)=>{const r="ILS"===t?"he-IL":"en-US";return new Intl.NumberFormat(r,{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)},E=new class{constructor(){t(this,"rateLimitMap",new Map),t(this,"blockedIPs",new Set),t(this,"suspiciousActivities",[]),t(this,"DEFAULT_CONFIG",{maxAttempts:5,windowMs:9e5,blockDurationMs:36e5})}checkRateLimit(e,t={}){const r={...this.DEFAULT_CONFIG,...t},s=Date.now(),a=this.rateLimitMap.get(e);if(!a)return this.rateLimitMap.set(e,{count:1,firstAttempt:s,lastAttempt:s}),{allowed:!0,remainingAttempts:r.maxAttempts-1,resetTime:s+r.windowMs};if(s-a.firstAttempt>r.windowMs)return this.rateLimitMap.set(e,{count:1,firstAttempt:s,lastAttempt:s}),{allowed:!0,remainingAttempts:r.maxAttempts-1,resetTime:s+r.windowMs};a.count++,a.lastAttempt=s;const n=a.count<=r.maxAttempts,i=Math.max(0,r.maxAttempts-a.count),o=a.firstAttempt+r.windowMs;return n||(this.blockedIPs.add(e),setTimeout(()=>{this.blockedIPs.delete(e),this.rateLimitMap.delete(e)},r.blockDurationMs),this.logSuspiciousActivity(e,"rate_limit_exceeded",{attempts:a.count,windowMs:r.windowMs})),{allowed:n,remainingAttempts:i,resetTime:o}}isBlocked(e){return this.blockedIPs.has(e)}sanitizeInput(e){return"string"!=typeof e?"":e.replace(/[<>\"'&]/g,e=>({"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","&":"&amp;"}[e]||e)).trim().slice(0,1e3)}validateCSRFToken(e,t){return!(!e||!t)&&e===this.generateCSRFToken(t)}generateCSRFToken(e){const t=Date.now().toString();return`${t}.${this.simpleHash(e+t)}`}getCSPHeader(){return["default-src 'self'","script-src 'self' 'unsafe-inline' https://js.lemonsqueezy.com","style-src 'self' 'unsafe-inline'","img-src 'self' data: https:","font-src 'self'","connect-src 'self' https://api.lemonsqueezy.com","frame-src https://lemonsqueezy.com","form-action 'self' https://lemonsqueezy.com","base-uri 'self'","object-src 'none'"].join("; ")}enforceHTTPS(){return"undefined"==typeof window||"https:"===window.location.protocol||"localhost"===window.location.hostname||(window.location.href=window.location.href.replace("http:","https:"),!1)}logSuspiciousActivity(e,t,r){const s={ip:e,activity:t,timestamp:new Date,details:r};this.suspiciousActivities.push(s),this.suspiciousActivities.length>1e3&&this.suspiciousActivities.splice(0,this.suspiciousActivities.length-1e3),this.sendToMonitoringService(s)}getSuspiciousActivities(e=100){return this.suspiciousActivities.slice(-e).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())}validatePaymentAmount(e,t){const r=[];let s="low";return e>1e4?(r.push("Unusually high amount"),s="high"):e>1e3&&(r.push("High amount transaction"),s="medium"),e%1e3==0&&e>=5e3&&(r.push("Suspicious round number"),s="high"===s?"high":"medium"),e<1&&(r.push("Very small amount - potential testing"),s="medium"),["USD","EUR"].includes(t.toUpperCase())||(r.push("Unsupported currency"),s="high"),{valid:"high"!==s,risk:s,reasons:r}}generateSessionToken(){const e=Date.now().toString(),t=Math.random().toString(36).substring(2);return`${e}.${t}.${this.simpleHash(e+t)}`}validateSessionToken(e){if(!e||"string"!=typeof e)return!1;const t=e.split(".");if(3!==t.length)return!1;const[r,s,a]=t;if(a!==this.simpleHash(r+s))return!1;const n=parseInt(r,10);return!(Date.now()-n>864e5)}simpleHash(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return Math.abs(t).toString(36)}sendToMonitoringService(e){"undefined"!=typeof window&&window.gtag&&window.gtag("event","security_alert",{event_category:"security",event_label:e.activity,custom_parameter_ip:e.ip})}cleanupRateLimits(){const e=Date.now(),t=this.DEFAULT_CONFIG.windowMs;for(const[r,s]of this.rateLimitMap.entries())e-s.lastAttempt>t&&this.rateLimitMap.delete(r)}getSecurityStats(){const e=Date.now()-36e5,t=this.suspiciousActivities.filter(t=>t.timestamp.getTime()>e).length;return{activeRateLimits:this.rateLimitMap.size,blockedIPs:this.blockedIPs.size,suspiciousActivities:this.suspiciousActivities.length,recentAlerts:t}}};var x=(e=>(e.VALIDATION="validation",e.NETWORK="network",e.PAYMENT="payment",e.AUTHENTICATION="authentication",e.AUTHORIZATION="authorization",e.RATE_LIMIT="rate_limit",e.SERVER="server",e.CLIENT="client",e.UNKNOWN="unknown",e))(x||{}),A=(e=>(e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e))(A||{});const v=new class{constructor(){t(this,"config",{enableLogging:!0,enableReporting:!0,maxRetries:3,retryDelay:2e3}),t(this,"errorLog",[]),t(this,"MAX_LOG_SIZE",1e3)}configure(e){this.config={...this.config,...e}}handleError(e,t){const r=this.parseError(e,t);return this.config.enableLogging&&this.logError(r),this.config.enableReporting&&"low"!==r.severity&&this.reportError(r),r}parseError(e,t){const r=new Date;let s;return s=e instanceof Error?this.parseJavaScriptError(e,t,r):"string"==typeof e?this.parseStringError(e,t,r):e?.response?this.parseHTTPError(e,t,r):e?.type?this.parseCustomError(e,t,r):this.parseUnknownError(e,t,r),s}parseJavaScriptError(e,t,r=new Date){let s="client",a="medium",n="An unexpected error occurred. Please try again.",i=!0;const o=e.message.toLowerCase();return o.includes("network")||o.includes("fetch")?(s="network",n="Network connection failed. Please check your internet connection and try again."):o.includes("validation")||o.includes("invalid")?(s="validation",a="low",n="Please check your input and try again.",i=!1):o.includes("payment")||o.includes("transaction")?(s="payment",a="high",n="Payment processing failed. Please try again or contact support."):o.includes("auth")?(s="authentication",a="high",n="Authentication failed. Please verify your credentials.",i=!1):(o.includes("rate limit")||o.includes("too many"))&&(s="rate_limit",n="Too many requests. Please wait a moment and try again."),{type:s,severity:a,message:e.message,userMessage:n,timestamp:r,context:t,stack:e.stack,retryable:i}}parseStringError(e,t,r=new Date){return{type:"client",severity:"low",message:e,userMessage:e,timestamp:r,context:t,retryable:!0}}parseHTTPError(e,t,r=new Date){const s=e.response?.status||0,a=e.response?.statusText||"Unknown",n=e.response?.data;let i,o="server",c="medium",l="Server error occurred. Please try again later.",u=!0;if(s>=400&&s<500)switch(o="client",u=!1,s){case 400:l="Invalid request. Please check your input.";break;case 401:o="authentication",c="high",l="Authentication required. Please sign in.";break;case 403:o="authorization",c="high",l="Access denied. You do not have permission to perform this action.";break;case 404:l="The requested resource was not found.";break;case 429:o="rate_limit",l="Too many requests. Please wait and try again.",u=!0,i=parseInt(e.response?.headers?.["retry-after"])||60;break;default:l="Request failed. Please check your input and try again."}else s>=500&&(c="high",l="Server error occurred. Please try again later.");return{type:o,severity:c,message:`HTTP ${s}: ${a}`,userMessage:l,code:s.toString(),details:n,timestamp:r,context:t,retryable:u,retryAfter:i}}parseCustomError(e,t,r=new Date){return{type:e.type||"unknown",severity:e.severity||"medium",message:e.message||"Unknown error",userMessage:e.userMessage||"An error occurred. Please try again.",code:e.code,details:e.details,timestamp:r,context:t,retryable:!1!==e.retryable,retryAfter:e.retryAfter}}parseUnknownError(e,t,r=new Date){return{type:"unknown",severity:"medium",message:JSON.stringify(e),userMessage:"An unexpected error occurred. Please try again.",details:e,timestamp:r,context:t,retryable:!0}}logError(e){this.getLogMethod(e.severity)(`[${e.type.toUpperCase()}] ${e.message}`,{context:e.context,timestamp:e.timestamp,details:e.details,stack:e.stack}),this.errorLog.unshift(e),this.errorLog.length>this.MAX_LOG_SIZE&&this.errorLog.splice(this.MAX_LOG_SIZE)}getLogMethod(e){switch(e){case"low":return console.info;case"medium":return console.warn;case"high":case"critical":return console.error;default:return console.log}}async reportError(e){try{this.config.reportingEndpoint&&await fetch(this.config.reportingEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,userAgent:navigator.userAgent,url:window.location.href,userId:this.getUserId()})}),"undefined"!=typeof window&&window.gtag&&window.gtag("event","exception",{description:e.message,fatal:"critical"===e.severity,error_type:e.type})}catch(t){}}getUserId(){}getErrorStats(){const e=Date.now()-36e5,t={total:this.errorLog.length,byType:{},bySeverity:{},recent:0};return Object.values(x).forEach(e=>{t.byType[e]=0}),Object.values(A).forEach(e=>{t.bySeverity[e]=0}),this.errorLog.forEach(r=>{t.byType[r.type]++,t.bySeverity[r.severity]++,r.timestamp.getTime()>e&&t.recent++}),t}getRecentErrors(e=50){return this.errorLog.slice(0,e)}clearErrorLog(){this.errorLog=[]}createRetryFunction(e,t){return async()=>{let r;for(let a=1;a<=this.config.maxRetries;a++)try{return await e()}catch(s){r=s;const e=this.handleError(s,t);if(!e.retryable||a===this.config.maxRetries)throw s;const n=e.retryAfter?1e3*e.retryAfter:this.config.retryDelay*a;await new Promise(e=>setTimeout(e,n))}throw r}}};var T=(e=>(e.PENDING="pending",e.COMPLETED="completed",e.FAILED="failed",e.REFUNDED="refunded",e))(T||{}),N=(e=>(e.PAYMENT_DECLINED="PAYMENT_DECLINED",e.INVALID_AMOUNT="INVALID_AMOUNT",e.NETWORK_ERROR="NETWORK_ERROR",e.API_ERROR="API_ERROR",e.USER_CANCELLED="USER_CANCELLED",e))(N||{});const w=new class{constructor(){t(this,"config");const e=g();this.config=e.LEMON_SQUEEZY}async createCheckout(e){try{const r={data:{type:"checkouts",attributes:{checkout_data:{custom:{amount:(t=e.amount,Math.round(100*t)),currency:e.currency}},product_options:{name:"Custom Payment",description:`Payment of ${e.amount} ${e.currency}`,redirect_url:g().REDIRECT_URLS.SUCCESS},checkout_options:{embed:!1,media:!1,logo:!1}},relationships:{store:{data:{type:"stores",id:this.config.STORE_ID}}}}};(e.customerEmail||e.customerName)&&(r.data.attributes.checkout_data.custom={...r.data.attributes.checkout_data.custom,customer_email:e.customerEmail||"",customer_name:e.customerName||""});const s=await fetch(`${this.config.API_BASE_URL}/checkouts`,{method:"POST",headers:{Authorization:`Bearer ${this.config.API_KEY}`,"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"},body:JSON.stringify(r)});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.errors?.[0]?.detail||`HTTP ${s.status}: ${s.statusText}`)}const a=await s.json();if(!a.data?.attributes?.url)throw new Error("Invalid response from Lemon Squeezy - missing checkout URL");return a.data.attributes.url}catch(r){throw this.handleError(r)}var t}async processPayment(e){try{if(!this.validatePaymentData(e))throw new Error("Invalid payment data");const t=await this.createCheckout(e);return window.location.href=t,{success:!0,transactionId:`pending-${Date.now()}`}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Payment processing failed"}}}validatePaymentData(e){return!(!e.amount||e.amount<=0||!e.currency||"ILS"!==e.currency||e.customerEmail&&!this.isValidEmail(e.customerEmail))}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}handleError(e){return e instanceof Error?e.message.includes("fetch")?{type:N.NETWORK_ERROR,message:"Network connection failed. Please check your internet connection.",details:e.message}:e.message.includes("HTTP")?{type:N.API_ERROR,message:"Payment service is temporarily unavailable. Please try again later.",details:e.message}:e.message.toLowerCase().includes("amount")?{type:N.INVALID_AMOUNT,message:"Invalid payment amount. Please check the amount and try again.",details:e.message}:{type:N.API_ERROR,message:e.message,details:e}:{type:N.API_ERROR,message:"An unexpected error occurred. Please try again.",details:e}}async getCheckoutStatus(e){try{const t=await fetch(`${this.config.API_BASE_URL}/checkouts/${e}`,{headers:{Authorization:`Bearer ${this.config.API_KEY}`,Accept:"application/vnd.api+json"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}catch(t){throw t}}verifyWebhookSignature(e,t){return t===this.config.WEBHOOK_SECRET}},b=new class{constructor(){t(this,"STORAGE_KEY","payment_transactions"),t(this,"MAX_TRANSACTIONS",1e3)}logTransaction(e){try{const t=this.getStoredTransactions(),r={...e,createdAt:e.createdAt||new Date};t.unshift(r),t.length>this.MAX_TRANSACTIONS&&t.splice(this.MAX_TRANSACTIONS),this.saveTransactions(t)}catch(t){}}getTransactions(e){try{let t=this.getStoredTransactions();return e?(e.status&&(t=t.filter(t=>t.status===e.status)),e.dateFrom&&(t=t.filter(t=>new Date(t.createdAt)>=e.dateFrom)),e.dateTo&&(t=t.filter(t=>new Date(t.createdAt)<=e.dateTo)),void 0!==e.minAmount&&(t=t.filter(t=>t.amount>=e.minAmount)),void 0!==e.maxAmount&&(t=t.filter(t=>t.amount<=e.maxAmount)),t):t}catch(t){return[]}}exportTransactions(e){try{const t=this.getStoredTransactions();if("json"===e)return JSON.stringify(t,null,2);if("csv"===e)return this.convertToCSV(t);throw new Error(`Unsupported export format: ${e}`)}catch(t){return""}}getTransactionById(e){try{return this.getStoredTransactions().find(t=>t.id===e)||null}catch(t){return null}}updateTransactionStatus(e,t,r){try{const s=this.getStoredTransactions(),a=s.findIndex(t=>t.id===e);return-1!==a&&(s[a]={...s[a],status:t,completedAt:r||(t===T.COMPLETED?new Date:void 0)},this.saveTransactions(s),!0)}catch(s){return!1}}getTransactionStats(){try{const e=this.getStoredTransactions(),t={total:e.length,completed:0,pending:0,failed:0,totalAmount:0,averageAmount:0};return e.forEach(e=>{switch(e.status){case T.COMPLETED:t.completed++,t.totalAmount+=e.amount;break;case T.PENDING:t.pending++;break;case T.FAILED:t.failed++}}),t.averageAmount=t.completed>0?t.totalAmount/t.completed:0,t}catch(e){return{total:0,completed:0,pending:0,failed:0,totalAmount:0,averageAmount:0}}}clearAllTransactions(){try{return localStorage.removeItem(this.STORAGE_KEY),!0}catch(e){return!1}}detectSuspiciousTransactions(){try{const e=this.getStoredTransactions(),t=[],r=new Date,s=36e5,a=e.filter(e=>r.getTime()-new Date(e.createdAt).getTime()<s),n=new Map;return a.forEach(e=>{const t=e.customerInfo?.email||e.customerInfo?.id||"unknown";n.has(t)||n.set(t,[]),n.get(t).push(e)}),n.forEach(e=>{e.filter(e=>e.status===T.FAILED).length>3&&t.push(...e);const r=e.filter(e=>e.amount>1e3);r.length>0&&t.push(...r)}),[...new Set(t)]}catch(e){return[]}}getStoredTransactions(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),completedAt:e.completedAt?new Date(e.completedAt):void 0})):[]}catch(e){return[]}}saveTransactions(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(t){if(t instanceof Error&&"QuotaExceededError"===t.name){const t=e.slice(0,Math.floor(this.MAX_TRANSACTIONS/2));localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}}}convertToCSV(e){if(0===e.length)return"No transactions to export";const t=e.map(e=>[e.id,e.amount.toString(),e.currency,e.status,e.createdAt.toISOString(),e.completedAt?.toISOString()||"",e.paymentMethodId,e.customerInfo?.email||"",e.customerInfo?.name||"",e.receiptUrl||""]);return[["ID","Amount","Currency","Status","Created At","Completed At","Payment Method","Customer Email","Customer Name","Receipt URL"].join(","),...t.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")}},S=({message:e="Loading...",size:t="medium"})=>s.jsx("div",{className:"loading-spinner",children:s.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[s.jsx("div",{className:`animate-spin rounded-full border-4 border-gray-300 border-t-blue-600 ${{small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"}[t]}`,role:"status","aria-label":"Loading"}),e&&s.jsx("p",{className:"mt-4 text-gray-600 text-center",children:e})]})}),I=({message:e,title:t="Error",onRetry:r,className:a=""})=>s.jsx("div",{className:`error-message bg-red-50 border border-red-200 rounded-lg p-6 ${a}`,children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z",clipRule:"evenodd"})})}),s.jsxs("div",{className:"ml-3 flex-1",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:t}),s.jsx("div",{className:"mt-2 text-sm text-red-700",children:s.jsx("p",{children:e})}),r&&s.jsx("div",{className:"mt-4",children:s.jsx("button",{type:"button",onClick:r,className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"Try Again"})})]})]})}),R=({error:e,isLoading:t=!1,isRetrying:a=!1,retryCount:n=0,maxRetries:i=3,onRetry:o,onDismiss:c,className:l=""})=>{const[u,m]=r.useState(!1),[d,h]=r.useState(null);if(r.useEffect(()=>{if(m(e||t||a),e&&e.severity===A.LOW&&!d){const e=setTimeout(()=>{m(!1),c&&c()},5e3);h(e)}return()=>{d&&(clearTimeout(d),h(null))}},[e,t,a,d,c]),!u)return null;if(t&&!e)return s.jsx("div",{className:`user-feedback loading ${l}`,children:s.jsxs("div",{className:"feedback-content",children:[s.jsx("div",{className:"loading-spinner",children:s.jsx("div",{className:"spinner"})}),s.jsx("div",{className:"feedback-message",children:s.jsx("p",{children:"Processing your request..."})})]})});if(a)return s.jsx("div",{className:`user-feedback retrying ${l}`,children:s.jsxs("div",{className:"feedback-content",children:[s.jsx("div",{className:"retry-icon",children:s.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("div",{className:"feedback-message",children:s.jsxs("p",{children:["Retrying... (Attempt ",n," of ",i,")"]})})]})});if(e){const t=e.severity.toLowerCase(),r=e.retryable&&n<i;return s.jsxs("div",{className:`user-feedback error ${t} ${l}`,children:[s.jsxs("div",{className:"feedback-content",children:[s.jsx("div",{className:"error-icon",children:e.severity===A.CRITICAL?s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}):e.severity===A.HIGH?s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}):s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),s.jsxs("div",{className:"feedback-message",children:[s.jsx("p",{className:"error-title",children:e.severity===A.CRITICAL?"Critical Error":e.severity===A.HIGH?"Error":e.severity===A.MEDIUM?"Warning":"Notice"}),s.jsx("p",{className:"error-description",children:e.userMessage}),e.code&&s.jsxs("p",{className:"error-code",children:["Error Code: ",e.code]}),n>0&&s.jsxs("p",{className:"retry-info",children:["Retry attempt ",n," of ",i]})]}),s.jsxs("div",{className:"feedback-actions",children:[r&&o&&s.jsx("button",{onClick:o,className:"btn btn-retry",disabled:a,children:a?"Retrying...":"Try Again"}),c&&s.jsx("button",{onClick:c,className:"btn btn-dismiss","aria-label":"Dismiss",children:"×"})]})]}),e.retryAfter&&s.jsx("div",{className:"retry-countdown",children:s.jsxs("p",{children:["Please wait ",e.retryAfter," seconds before retrying"]})})]})}return null},k=({onSubmit:e,isProcessing:t=!1})=>{const[a,n]=r.useState({amount:0,currency:"ILS",customerEmail:"",customerName:""}),[i,o]=r.useState([]),[c,l]=r.useState(!1),[u,m]=r.useState(null),{isBlocked:h,remainingAttempts:g,checkRateLimit:x,sanitizeInput:N,validatePaymentAmount:k,logSuspiciousActivity:j,enforceHTTPS:C}=((e={})=>{const[t,s]=r.useState(!1),[a,n]=r.useState(0),[i,o]=r.useState(0),[c,l]=r.useState({activeRateLimits:0,blockedIPs:0,suspiciousActivities:0,recentAlerts:0}),u=e.identifier||"default";return r.useEffect(()=>{const e=E.isBlocked(u);s(e)},[u]),r.useEffect(()=>{const e=()=>{const e=E.getSecurityStats();l(e)};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[]),{isBlocked:t,remainingAttempts:a,resetTime:i,securityStats:c,checkRateLimit:r.useCallback(()=>{const t=E.checkRateLimit(u,{maxAttempts:e.maxAttempts,windowMs:e.windowMs,blockDurationMs:e.blockDurationMs});return s(!t.allowed),n(t.remainingAttempts),o(t.resetTime),t},[u,e.maxAttempts,e.windowMs,e.blockDurationMs]),sanitizeInput:r.useCallback(e=>E.sanitizeInput(e),[]),generateCSRFToken:r.useCallback(e=>E.generateCSRFToken(e),[]),validateCSRFToken:r.useCallback((e,t)=>E.validateCSRFToken(e,t),[]),enforceHTTPS:r.useCallback(()=>E.enforceHTTPS(),[]),logSuspiciousActivity:r.useCallback((e,t)=>{E.logSuspiciousActivity(u,e,t)},[u]),getSuspiciousActivities:r.useCallback(e=>E.getSuspiciousActivities(e),[]),validatePaymentAmount:r.useCallback((e,t)=>E.validatePaymentAmount(e,t),[]),generateSessionToken:r.useCallback(()=>E.generateSessionToken(),[]),validateSessionToken:r.useCallback(e=>E.validateSessionToken(e),[]),getCSPHeader:r.useCallback(()=>E.getCSPHeader(),[]),cleanupRateLimits:r.useCallback(()=>{E.cleanupRateLimits()},[])}})({identifier:"payment_form",maxAttempts:5,windowMs:9e5}),{currentError:L,handleError:_,clearError:M,retry:D,isRetrying:O,retryCount:P,isRetryable:U,getUserMessage:H}=((e={})=>{const[t,s]=r.useState({currentError:null,errorHistory:[],isRetrying:!1,retryCount:0}),{context:a,autoRetry:n=!1,maxRetries:i=3,onError:o,onRetry:c,onMaxRetriesReached:l}=e,u=r.useCallback((e,t)=>{const r=v.handleError(e,t||a);return s(e=>({...e,currentError:r,errorHistory:[r,...e.errorHistory.slice(0,9)]})),o&&o(r),r},[a,o]),m=r.useCallback(()=>{s(e=>({...e,currentError:null,isRetrying:!1,retryCount:0}))},[]),d=r.useCallback(()=>{s({currentError:null,errorHistory:[],isRetrying:!1,retryCount:0})},[]),h=r.useCallback(async(e,r)=>{const a=t.retryCount+1;s(e=>({...e,isRetrying:!0,retryCount:a})),c&&c(a);try{const t=await e();return s(e=>({...e,currentError:null,isRetrying:!1,retryCount:0})),t}catch(o){const t=u(o,r);if(s(e=>({...e,isRetrying:!1})),t.retryable&&a<i){if(n){const s=t.retryAfter?1e3*t.retryAfter:2e3*a;setTimeout(()=>{h(e,r)},s)}}else a>=i&&l&&l(t);throw o}},[t.retryCount,u,i,n,c,l]),p=r.useCallback((e,t)=>v.createRetryFunction(e,t||a),[a]),g=r.useCallback(()=>v.getErrorStats(),[]),y=r.useCallback(e=>v.getRecentErrors(e),[]),f=r.useCallback(e=>t.currentError?.type===e,[t.currentError]),E=r.useCallback(e=>t.currentError?.severity===e,[t.currentError]),x=r.useCallback(()=>!0===t.currentError?.retryable&&t.retryCount<i,[t.currentError,t.retryCount,i]),T=r.useCallback(()=>t.currentError?.userMessage||"An unexpected error occurred.",[t.currentError]),N=r.useCallback(()=>t.currentError?.message||"",[t.currentError]);return r.useEffect(()=>{if(t.currentError&&t.currentError.severity===A.LOW){const e=setTimeout(()=>{m()},5e3);return()=>clearTimeout(e)}},[t.currentError,m]),{currentError:t.currentError,errorHistory:t.errorHistory,isRetrying:t.isRetrying,retryCount:t.retryCount,hasError:null!==t.currentError,handleError:u,clearError:m,clearAllErrors:d,retry:h,createRetryFunction:p,getErrorStats:g,getRecentErrors:y,isErrorType:f,isErrorSeverity:E,isRetryable:x,getUserMessage:T,getTechnicalMessage:N}})({context:"payment_form",maxRetries:3,onError:e=>{j("payment_error",{type:e.type,severity:e.severity,message:e.message})}});r.useEffect(()=>{C()},[C]);const $=(e,t)=>{let r=t;if("string"==typeof t&&(r=N(t)),"amount"===e&&"string"==typeof t){const e=parseFloat(t);r=isNaN(e)?0:e}n(t=>({...t,[e]:r})),o(t=>t.filter(t=>t.field!==e)),m(null)},F=async t=>{if(t.preventDefault(),h)return void m(`Too many attempts. Please try again later. Remaining attempts: ${g}`);const r=x();if(!r.allowed)return m("Rate limit exceeded. Please try again later."),void j("rate_limit_exceeded",{attempts:r.remainingAttempts});const s=(e=>{try{return y.parse(e),[]}catch(t){return t instanceof d?t.errors.map(t=>({field:t.path.join("."),message:t.message,value:"invalid_type"===t.code?void 0:e[t.path[0]]})):[{field:"general",message:"Validation failed"}]}})(a);if(s.length>0)return o(s),void j("validation_failed",{errors:s});const n=k(a.amount,a.currency);if(!n.valid)return m(`Payment amount validation failed: ${n.reasons.join(", ")}`),void j("suspicious_amount",{amount:a.amount,currency:a.currency,risk:n.risk,reasons:n.reasons});"high"===n.risk&&j("high_risk_transaction",{amount:a.amount,currency:a.currency,reasons:n.reasons}),l(!0),m(null),o([]);try{if(e)await e(a);else{const e={id:`txn_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:a.amount,currency:a.currency,status:T.PENDING,createdAt:new Date,paymentMethodId:"lemon-squeezy",customerInfo:{email:a.customerEmail,name:a.customerName}};if(b.logTransaction(e),!(await w.processPayment(a)).success)throw b.updateTransactionStatus(e.id,T.FAILED),new Error("Payment system configuration is incomplete. Please contact support.")}}catch(i){const e=_(i,"payment_submission");m(e.userMessage)}finally{l(!1)}},z=e=>i.find(t=>t.field===e)?.message,V=0===i.length&&a.amount>0,q=t||c;return s.jsx("div",{className:"payment-form",children:s.jsxs("form",{onSubmit:F,className:"space-y-6",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-2",children:"סכום לתשלום (בשקלים) *"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("span",{className:"text-gray-500 sm:text-sm",children:"₪"})}),s.jsx("input",{type:"number",id:"amount",name:"amount",min:p.VALIDATION.MIN_AMOUNT,max:p.VALIDATION.MAX_AMOUNT,step:"0.01",value:a.amount||"",onChange:e=>$("amount",e.target.value),className:"block w-full pl-7 pr-3 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(z("amount")?"border-red-300":"border-gray-300"),placeholder:"0.00",disabled:q,required:!0})]}),z("amount")&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:z("amount")}),a.amount>0&&s.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Total: ",f(a.amount,a.currency)]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"customerEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"כתובת אימייל (אופציונלי)"}),s.jsx("input",{type:"email",id:"customerEmail",name:"customerEmail",value:a.customerEmail,onChange:e=>$("customerEmail",e.target.value),className:"block w-full px-3 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(z("customerEmail")?"border-red-300":"border-gray-300"),placeholder:"your@email.com",disabled:q}),z("customerEmail")&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:z("customerEmail")})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"customerName",className:"block text-sm font-medium text-gray-700 mb-2",children:"שם מלא (אופציונלי)"}),s.jsx("input",{type:"text",id:"customerName",name:"customerName",value:a.customerName,onChange:e=>$("customerName",e.target.value),className:"block w-full px-3 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(z("customerName")?"border-red-300":"border-gray-300"),placeholder:"Your full name",disabled:q}),z("customerName")&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:z("customerName")})]}),u&&s.jsx(I,{message:u,title:"Payment Error",onRetry:U()?()=>D(()=>F({preventDefault:()=>{}})):void 0}),s.jsx(R,{error:L,isLoading:q,isRetrying:O,retryCount:P,maxRetries:3,onRetry:U()?()=>D(()=>F({preventDefault:()=>{}})):void 0,onDismiss:M}),s.jsx("div",{className:"form-group",children:s.jsx("button",{type:"submit",disabled:!V||q,className:"w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 "+(!V||q?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:q?s.jsxs(s.Fragment,{children:[s.jsx(S,{size:"small"}),s.jsx("span",{className:"ml-2",children:"מעבד תשלום..."})]}):s.jsxs(s.Fragment,{children:["המשך לתשלום",a.amount>0&&s.jsxs("span",{className:"ml-2",children:["(",f(a.amount,a.currency),")"]})]})})}),s.jsx("div",{className:"text-center text-sm text-gray-500",children:s.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),s.jsx("span",{children:"תשלום מאובטח באמצעות Lemon Squeezy"})]})})]})})},j=()=>s.jsxs("div",{className:"flex flex-col min-h-screen",children:[s.jsxs(a,{children:[s.jsx("title",{children:"תשלום מאובטח - דוקטור פיקס שחזור קבצים"}),s.jsx("meta",{name:"description",content:"דף תשלום מאובטח עבור שירותי שחזור קבצים ונתונים"}),s.jsx("meta",{name:"robots",content:"noindex, nofollow"}),s.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),s.jsx("meta",{httpEquiv:"X-Content-Type-Options",content:"nosniff"}),s.jsx("meta",{httpEquiv:"X-Frame-Options",content:"DENY"}),s.jsx("meta",{httpEquiv:"X-XSS-Protection",content:"1; mode=block"}),s.jsx("meta",{httpEquiv:"Referrer-Policy",content:"strict-origin-when-cross-origin"}),s.jsx("link",{rel:"preconnect",href:"https://api.lemonsqueezy.com"}),s.jsx("link",{rel:"preconnect",href:"https://lemonsqueezy.com"}),s.jsx("meta",{httpEquiv:"Cache-Control",content:"no-cache, no-store, must-revalidate"}),s.jsx("meta",{httpEquiv:"Pragma",content:"no-cache"}),s.jsx("meta",{httpEquiv:"Expires",content:"0"})]}),s.jsx(n,{}),s.jsx("main",{className:"flex-grow bg-gray-50",children:s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"max-w-2xl mx-auto",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"תשלום מאובטח לשחזור קבצים"}),s.jsx("p",{className:"text-lg text-gray-600",children:"בצעו תשלום מאובטח עבור שירותי שחזור הקבצים שלנו"})]}),s.jsx(k,{})]})})})}),s.jsx(i,{})]});export{j as default};
